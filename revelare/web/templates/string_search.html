{% extends "base.html" %}

{% block title %}String Search - Project Revelare{% endblock %}

{% block content %}
<div class="string-search">
    <div class="page-header">
        <h1><i class="fas fa-search"></i> String Search</h1>
        <p>Search for specific strings within project files and archives</p>
    </div>

    <div class="search-section">
        <div class="search-card">
            <h2><i class="fas fa-search"></i> Configure String Search</h2>
            <form method="POST" class="search-form">
                <div class="form-group">
                    <label for="project_name">Project:</label>
                    <select id="project_name" name="project_name" required>
                        <option value="">Select a project...</option>
                        {% for project in projects %}
                        <option value="{{ project.name }}">{{ project.name }}</option>
                        {% endfor %}
                    </select>
                    <div class="help-text">Choose the project to search within</div>
                </div>

                <div class="form-group">
                    <label for="search_strings">Search Strings:</label>
                    <textarea name="search_strings" id="search_strings" 
                              placeholder="Enter search strings separated by commas&#10;Example: password, secret, api_key, token" 
                              required></textarea>
                    <div class="help-text">Enter one or more strings to search for, separated by commas</div>
                </div>

                <div class="form-group">
                    <label for="file_extensions">File Extensions (optional):</label>
                    <input type="text" name="file_extensions" id="file_extensions" 
                           placeholder=".txt, .log, .csv, .json">
                    <div class="help-text">Limit search to specific file types (leave empty to search all files)</div>
                </div>

                <div class="form-group">
                    <label for="context_chars">Context Characters:</label>
                    <input type="number" name="context_chars" id="context_chars" 
                           value="50" min="10" max="500">
                    <div class="help-text">Number of characters to show around each match (10-500)</div>
                </div>

                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search
                </button>
            </form>
        </div>
    </div>

    <div class="features-section">
        <h2><i class="fas fa-star"></i> String Search Features</h2>
        <div class="features-grid">
            <div class="feature-card">
                <i class="fas fa-archive"></i>
                <h3>Archive Support</h3>
                <p>Searches inside ZIP files and nested archives automatically</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-eye"></i>
                <h3>Context Display</h3>
                <p>Shows surrounding text for each match to understand the context</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-filter"></i>
                <h3>File Filtering</h3>
                <p>Search specific file types or all files based on your needs</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-download"></i>
                <h3>CSV Export</h3>
                <p>Results saved as CSV for further analysis and reporting</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-project-diagram"></i>
                <h3>Project Integration</h3>
                <p>Works seamlessly with existing Revelare projects</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-shield-alt"></i>
                <h3>Secure Processing</h3>
                <p>Safe file handling with security validation and path protection</p>
            </div>
        </div>
    </div>

    <div class="help-section">
        <h2><i class="fas fa-question-circle"></i> How to Use String Search</h2>
        <div class="help-content">
            <div class="help-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h3>Select Project</h3>
                    <p>Choose the project containing the files you want to search through. The project must be fully processed before searching.</p>
                </div>
            </div>
            <div class="help-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>Enter Search Strings</h3>
                    <p>Specify the strings you want to find. You can search for multiple strings by separating them with commas.</p>
                </div>
            </div>
            <div class="help-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>Configure Options</h3>
                    <p>Optionally filter by file extensions and set the context window size for better results.</p>
                </div>
            </div>
            <div class="help-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h3>Review Results</h3>
                    <p>Examine the search results with context and export them for further analysis if needed.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.querySelector('.search-form');
    const searchStringsInput = document.getElementById('search_strings');
    const fileExtensionsInput = document.getElementById('file_extensions');
    
    // Auto-focus search strings input
    searchStringsInput.focus();
    
    // Handle form submission with loading state
    searchForm.addEventListener('submit', function() {
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
        submitBtn.disabled = true;
        
        // Re-enable after a short delay (in case of errors)
        setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }, 10000);
    });
    
    // Auto-format file extensions input
    fileExtensionsInput.addEventListener('input', function() {
        let value = this.value;
        // Remove spaces and ensure dots are present
        value = value.replace(/\s/g, '');
        if (value && !value.startsWith('.')) {
            value = value.split(',').map(ext => ext.startsWith('.') ? ext : '.' + ext).join(', ');
        }
        this.value = value;
    });
    
    // Auto-format search strings input
    searchStringsInput.addEventListener('input', function() {
        let value = this.value;
        // Remove extra spaces around commas
        value = value.replace(/\s*,\s*/g, ', ');
        this.value = value;
    });
});
</script>
{% endblock %}
