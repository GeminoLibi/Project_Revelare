{% extends "base.html" %}

{% block title %}MBOX Viewer - Project Revelare{% endblock %}

{% block content %}
<div class="mbox-viewer">
    <div class="page-header">
        <h1><i class="fas fa-envelope"></i> MBOX Viewer</h1>
        <p>View and analyze email archives in MBOX format</p>
    </div>

    <div class="upload-section">
        <div class="upload-card">
            <h2><i class="fas fa-upload"></i> Upload MBOX File</h2>
            <form method="POST" enctype="multipart/form-data" class="upload-form">
                <div class="form-group">
                    <label for="mbox_file">MBOX File:</label>
                    <div class="file-upload-area" id="file-upload-area">
                        <i class="fas fa-file-archive"></i>
                        <p>Select an MBOX file to analyze</p>
                        <input type="file" id="mbox_file" name="mbox_file" 
                               accept=".mbox" required>
                        <div class="file-info" id="file-info"></div>
                    </div>
                    <div class="help-text">Upload an MBOX file to view and analyze email content</div>
                </div>

                <div class="form-group">
                    <label for="max_emails">Maximum Emails to Display:</label>
                    <input type="number" id="max_emails" name="max_emails" 
                           value="100" min="1" max="1000">
                    <div class="help-text">Limit the number of emails displayed (1-1000)</div>
                </div>

                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-eye"></i> View Emails
                </button>
            </form>
        </div>
    </div>

    <div class="features-section">
        <h2><i class="fas fa-star"></i> MBOX Viewer Features</h2>
        <div class="features-grid">
            <div class="feature-card">
                <i class="fas fa-envelope-open"></i>
                <h3>Email Parsing</h3>
                <p>Parse and display individual emails from MBOX archives with full headers and content</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-search"></i>
                <h3>Content Search</h3>
                <p>Search through email content, headers, and metadata to find specific information</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-calendar"></i>
                <h3>Timeline View</h3>
                <p>View emails in chronological order to understand communication patterns</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-user"></i>
                <h3>Contact Analysis</h3>
                <p>Extract and analyze sender/recipient information for contact mapping</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-paperclip"></i>
                <h3>Attachment Support</h3>
                <p>View and extract attachments from email messages</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-download"></i>
                <h3>Export Options</h3>
                <p>Export email data in various formats for further analysis</p>
            </div>
        </div>
    </div>

    <div class="help-section">
        <h2><i class="fas fa-question-circle"></i> About MBOX Format</h2>
        <div class="help-content">
            <div class="help-info">
                <h3>What is MBOX?</h3>
                <p>MBOX is a common format for storing email messages. It's used by many email clients and systems to archive emails in a single file.</p>
            </div>
            <div class="help-info">
                <h3>Supported Features</h3>
                <ul>
                    <li>Email headers (From, To, Subject, Date, etc.)</li>
                    <li>Email body content (plain text and HTML)</li>
                    <li>Attachments and embedded content</li>
                    <li>Threaded conversations</li>
                    <li>Metadata extraction</li>
                </ul>
            </div>
            <div class="help-info">
                <h3>Use Cases</h3>
                <ul>
                    <li>Email forensics and investigation</li>
                    <li>Communication pattern analysis</li>
                    <li>Contact and relationship mapping</li>
                    <li>Evidence preservation and review</li>
                    <li>Compliance and audit requirements</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileUploadArea = document.getElementById('file-upload-area');
    const fileInput = document.getElementById('mbox_file');
    const fileInfo = document.getElementById('file-info');

    // Handle drag and drop
    fileUploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        fileUploadArea.classList.add('dragover');
    });

    fileUploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
    });

    fileUploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
        fileInput.files = e.dataTransfer.files;
        updateFileInfo();
    });

    // Handle file input change
    fileInput.addEventListener('change', updateFileInfo);

    // Update file info display
    function updateFileInfo() {
        const file = fileInput.files[0];
        if (file) {
            fileInfo.innerHTML = `
                <div class="file-details">
                    <i class="fas fa-file-archive"></i>
                    <div class="file-details-content">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                </div>
            `;
        } else {
            fileInfo.innerHTML = '';
        }
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
});
</script>
{% endblock %}
