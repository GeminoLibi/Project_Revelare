<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Intelligence - Project Revelare</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3891410174900441"
         crossorigin="anonymous"></script>
    
    <!-- Upgrade Redirect Script -->
    <script src="/js/upgrade-redirect.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0F172A;
            color: #F8FAFC;
        }
        h1, h2, h3, h4 {
            font-family: 'Orbitron', sans-serif;
        }
        .card {
            background-color: #1E293B;
            border-top: 4px solid #3B82F6;
        }
        .intelligence-card {
            background-color: #1E293B;
            border-left: 4px solid #10B981;
            position: relative;
        }
        .professional-badge {
            position: absolute;
            top: -8px;
            right: 16px;
            background: linear-gradient(45deg, #10B981, #059669);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .loading-spinner {
            border: 3px solid #374151;
            border-top: 3px solid #10B981;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .result-card {
            background-color: #374151;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .api-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .api-status.available {
            background-color: #10B981;
            color: white;
        }
        .api-status.unavailable {
            background-color: #EF4444;
            color: white;
        }
        .api-status.limited {
            background-color: #F59E0B;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- Navigation Container -->
    <div id="navigation-container"></div>

    <main class="pt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-white mb-2">API Intelligence</h1>
                <p class="text-gray-400">External API integration for enhanced forensic analysis</p>
                <div class="mt-2">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-900 text-green-200">
                        <i class="fas fa-crown mr-2"></i>
                        Professional Tier Feature
                    </span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- IP Geolocation -->
                <div class="intelligence-card p-6 rounded-lg">
                    <div class="professional-badge">PROFESSIONAL</div>
                    <h2 class="text-xl font-semibold text-white mb-4">
                        <i class="fas fa-globe text-blue-500"></i> IP Geolocation
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">IP Address</label>
                            <div class="flex space-x-2">
                                <input type="text" id="ipInput" placeholder="192.168.1.1" 
                                       class="flex-1 px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button onclick="lookupIP()" 
                                        class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="ipResults" class="hidden">
                            <!-- Results will be populated here -->
                        </div>
                        
                        <div id="ipLoading" class="hidden text-center">
                            <div class="loading-spinner mx-auto mb-2"></div>
                            <p class="text-gray-400">Looking up IP address...</p>
                        </div>
                    </div>
                </div>

                <!-- Phone Number Lookup -->
                <div class="intelligence-card p-6 rounded-lg">
                    <div class="professional-badge">PROFESSIONAL</div>
                    <h2 class="text-xl font-semibold text-white mb-4">
                        <i class="fas fa-phone text-green-500"></i> Phone Lookup
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                            <div class="flex space-x-2">
                                <input type="text" id="phoneInput" placeholder="+1-555-123-4567" 
                                       class="flex-1 px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                                <button onclick="lookupPhone()" 
                                        class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="phoneResults" class="hidden">
                            <!-- Results will be populated here -->
                        </div>
                        
                        <div id="phoneLoading" class="hidden text-center">
                            <div class="loading-spinner mx-auto mb-2"></div>
                            <p class="text-gray-400">Looking up phone number...</p>
                        </div>
                    </div>
                </div>

                <!-- Domain Validation -->
                <div class="intelligence-card p-6 rounded-lg">
                    <div class="professional-badge">PROFESSIONAL</div>
                    <h2 class="text-xl font-semibold text-white mb-4">
                        <i class="fas fa-globe-americas text-purple-500"></i> Domain Validation
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Domain</label>
                            <div class="flex space-x-2">
                                <input type="text" id="domainInput" placeholder="example.com" 
                                       class="flex-1 px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <button onclick="validateDomain()" 
                                        class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="domainResults" class="hidden">
                            <!-- Results will be populated here -->
                        </div>
                        
                        <div id="domainLoading" class="hidden text-center">
                            <div class="loading-spinner mx-auto mb-2"></div>
                            <p class="text-gray-400">Validating domain...</p>
                        </div>
                    </div>
                </div>

                <!-- Threat Intelligence -->
                <div class="intelligence-card p-6 rounded-lg">
                    <div class="professional-badge">PROFESSIONAL</div>
                    <h2 class="text-xl font-semibold text-white mb-4">
                        <i class="fas fa-shield-alt text-red-500"></i> Threat Intelligence
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Indicator</label>
                            <div class="flex space-x-2">
                                <input type="text" id="threatInput" placeholder="IP, Domain, Hash, or URL" 
                                       class="flex-1 px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500">
                                <button onclick="analyzeThreat()" 
                                        class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Type</label>
                            <select id="threatType" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="auto">Auto-detect</option>
                                <option value="ip">IP Address</option>
                                <option value="domain">Domain</option>
                                <option value="hash">Hash</option>
                                <option value="url">URL</option>
                            </select>
                        </div>
                        
                        <div id="threatResults" class="hidden">
                            <!-- Results will be populated here -->
                        </div>
                        
                        <div id="threatLoading" class="hidden text-center">
                            <div class="loading-spinner mx-auto mb-2"></div>
                            <p class="text-gray-400">Analyzing threat...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bulk Analysis -->
            <div class="intelligence-card p-6 rounded-lg mt-8">
                <div class="professional-badge">PROFESSIONAL</div>
                <h2 class="text-xl font-semibold text-white mb-4">
                    <i class="fas fa-list-alt text-yellow-500"></i> Bulk Analysis
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Indicators (one per line)</label>
                        <textarea id="bulkInput" rows="6" placeholder="192.168.1.1&#10;example.com&#10;malicious-domain.net&#10;+1-555-123-4567" 
                                  class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
                    </div>
                    
                    <button onclick="bulkAnalyze()" 
                            class="w-full bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 transition">
                        <i class="fas fa-cogs mr-2"></i>
                        Analyze All Indicators
                    </button>
                    
                    <div id="bulkResults" class="hidden">
                        <!-- Results will be populated here -->
                    </div>
                    
                    <div id="bulkLoading" class="hidden text-center">
                        <div class="loading-spinner mx-auto mb-2"></div>
                        <p class="text-gray-400">Analyzing indicators...</p>
                    </div>
                </div>
            </div>

            <!-- API Status Dashboard -->
            <div class="intelligence-card p-6 rounded-lg mt-8">
                <div class="professional-badge">PROFESSIONAL</div>
                <h2 class="text-xl font-semibold text-white mb-4">
                    <i class="fas fa-chart-line text-blue-500"></i> API Status Dashboard
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-globe text-blue-400"></i> IP Geolocation
                        </h4>
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">ip-api.com</span>
                                <span class="api-status available">Available</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">ipinfo.io</span>
                                <span class="api-status unavailable" id="ipinfo-status">API Key Required</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-phone text-green-400"></i> Phone Lookup
                        </h4>
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">Twilio Lookup</span>
                                <span class="api-status unavailable" id="twilio-status">API Key Required</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">Area Codes</span>
                                <span class="api-status available">Available</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-shield-alt text-red-400"></i> Threat Intel
                        </h4>
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">VirusTotal</span>
                                <span class="api-status unavailable" id="virustotal-status">API Key Required</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">AbuseIPDB</span>
                                <span class="api-status unavailable" id="abuseipdb-status">API Key Required</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">Shodan</span>
                                <span class="api-status unavailable" id="shodan-status">API Key Required</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-globe-americas text-purple-400"></i> Domain Intel
                        </h4>
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">WHOIS</span>
                                <span class="api-status available">Available</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300 text-sm">DNS Lookup</span>
                                <span class="api-status available">Available</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Load navigation
        fetch('/components/navigation.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('navigation-container').innerHTML = html;
                
                // Load navigation JavaScript after component is loaded
                const script = document.createElement('script');
                script.src = '/js/navigation.js';
                document.head.appendChild(script);
            });

        const API_BASE_URL = 'https://project-revelare-backend.liberatorgeminorum.workers.dev';

        async function lookupIP() {
            const ip = document.getElementById('ipInput').value.trim();
            if (!ip) {
                alert('Please enter an IP address');
                return;
            }

            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please log in to use API intelligence features');
                return;
            }

            try {
                document.getElementById('ipLoading').classList.remove('hidden');
                document.getElementById('ipResults').classList.add('hidden');

                const response = await fetch(`${API_BASE_URL}/api/geolocation/ip/${ip}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                document.getElementById('ipLoading').classList.add('hidden');
                document.getElementById('ipResults').classList.remove('hidden');
                
                displayIPResults(data);

            } catch (error) {
                console.error('IP lookup error:', error);
                document.getElementById('ipLoading').classList.add('hidden');
                alert('IP lookup failed: ' + error.message);
            }
        }

        function displayIPResults(data) {
            const resultsDiv = document.getElementById('ipResults');
            
            if (!data.success) {
                resultsDiv.innerHTML = `<div class="text-red-400">Error: ${data.message}</div>`;
                return;
            }

            let html = `<div class="space-y-4">`;
            
            if (data.geolocation.ip_api) {
                const geo = data.geolocation.ip_api;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-map-marker-alt text-blue-400"></i> ${geo.source}
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-400">Country:</span> ${geo.country || 'N/A'}</div>
                            <div><span class="text-gray-400">Region:</span> ${geo.region || 'N/A'}</div>
                            <div><span class="text-gray-400">City:</span> ${geo.city || 'N/A'}</div>
                            <div><span class="text-gray-400">ZIP:</span> ${geo.zip || 'N/A'}</div>
                            <div><span class="text-gray-400">ISP:</span> ${geo.isp || 'N/A'}</div>
                            <div><span class="text-gray-400">Organization:</span> ${geo.organization || 'N/A'}</div>
                            <div><span class="text-gray-400">ASN:</span> ${geo.asn || 'N/A'}</div>
                            <div><span class="text-gray-400">Timezone:</span> ${geo.timezone || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            if (data.geolocation.ipinfo) {
                const geo = data.geolocation.ipinfo;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-map-marker-alt text-green-400"></i> ${geo.source}
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-400">Country:</span> ${geo.country || 'N/A'}</div>
                            <div><span class="text-gray-400">Region:</span> ${geo.region || 'N/A'}</div>
                            <div><span class="text-gray-400">City:</span> ${geo.city || 'N/A'}</div>
                            <div><span class="text-gray-400">Postal:</span> ${geo.postal || 'N/A'}</div>
                            <div><span class="text-gray-400">ISP:</span> ${geo.isp || 'N/A'}</div>
                            <div><span class="text-gray-400">Timezone:</span> ${geo.timezone || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
            resultsDiv.innerHTML = html;
        }

        async function lookupPhone() {
            const phone = document.getElementById('phoneInput').value.trim();
            if (!phone) {
                alert('Please enter a phone number');
                return;
            }

            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please log in to use API intelligence features');
                return;
            }

            try {
                document.getElementById('phoneLoading').classList.remove('hidden');
                document.getElementById('phoneResults').classList.add('hidden');

                const response = await fetch(`${API_BASE_URL}/api/lookup/phone/${encodeURIComponent(phone)}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                document.getElementById('phoneLoading').classList.add('hidden');
                document.getElementById('phoneResults').classList.remove('hidden');
                
                displayPhoneResults(data);

            } catch (error) {
                console.error('Phone lookup error:', error);
                document.getElementById('phoneLoading').classList.add('hidden');
                alert('Phone lookup failed: ' + error.message);
            }
        }

        function displayPhoneResults(data) {
            const resultsDiv = document.getElementById('phoneResults');
            
            if (!data.success) {
                resultsDiv.innerHTML = `<div class="text-red-400">Error: ${data.message}</div>`;
                return;
            }

            let html = `<div class="space-y-4">`;
            
            if (data.lookup.twilio) {
                const twilio = data.lookup.twilio;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-phone text-green-400"></i> ${twilio.source}
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-400">Number:</span> ${twilio.phoneNumber || 'N/A'}</div>
                            <div><span class="text-gray-400">Format:</span> ${twilio.nationalFormat || 'N/A'}</div>
                            <div><span class="text-gray-400">Country:</span> ${twilio.countryCode || 'N/A'}</div>
                            <div><span class="text-gray-400">Carrier:</span> ${twilio.carrier || 'N/A'}</div>
                            <div><span class="text-gray-400">Type:</span> ${twilio.lineType || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            if (data.lookup.areaCode) {
                const area = data.lookup.areaCode;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-map-marker-alt text-blue-400"></i> ${area.source}
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-400">Area Code:</span> ${area.code}</div>
                            <div><span class="text-gray-400">Region:</span> ${area.region}</div>
                            <div><span class="text-gray-400">Country:</span> ${area.country}</div>
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
            resultsDiv.innerHTML = html;
        }

        async function validateDomain() {
            const domain = document.getElementById('domainInput').value.trim();
            if (!domain) {
                alert('Please enter a domain');
                return;
            }

            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please log in to use API intelligence features');
                return;
            }

            try {
                document.getElementById('domainLoading').classList.remove('hidden');
                document.getElementById('domainResults').classList.add('hidden');

                const response = await fetch(`${API_BASE_URL}/api/validate/domain/${domain}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                document.getElementById('domainLoading').classList.add('hidden');
                document.getElementById('domainResults').classList.remove('hidden');
                
                displayDomainResults(data);

            } catch (error) {
                console.error('Domain validation error:', error);
                document.getElementById('domainLoading').classList.add('hidden');
                alert('Domain validation failed: ' + error.message);
            }
        }

        function displayDomainResults(data) {
            const resultsDiv = document.getElementById('domainResults');
            
            if (!data.success) {
                resultsDiv.innerHTML = `<div class="text-red-400">Error: ${data.message}</div>`;
                return;
            }

            let html = `<div class="space-y-4">`;
            
            if (data.validation.whois) {
                const whois = data.validation.whois;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-info-circle text-purple-400"></i> ${whois.source}
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-400">Domain:</span> ${whois.domain || 'N/A'}</div>
                            <div><span class="text-gray-400">Registrar:</span> ${whois.registrar || 'N/A'}</div>
                            <div><span class="text-gray-400">Created:</span> ${whois.createdDate || 'N/A'}</div>
                            <div><span class="text-gray-400">Updated:</span> ${whois.updatedDate || 'N/A'}</div>
                            <div><span class="text-gray-400">Expires:</span> ${whois.expiresDate || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            if (data.validation.dns) {
                const dns = data.validation.dns;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-server text-blue-400"></i> ${dns.source}
                        </h4>
                        <div class="text-sm">
                            <div class="text-gray-400 mb-2">DNS Records:</div>
                            ${dns.records.map(record => 
                                `<div class="ml-4 text-gray-300">${record.name} → ${record.data}</div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
            resultsDiv.innerHTML = html;
        }

        async function analyzeThreat() {
            const indicator = document.getElementById('threatInput').value.trim();
            const type = document.getElementById('threatType').value;
            
            if (!indicator) {
                alert('Please enter an indicator');
                return;
            }

            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please log in to use API intelligence features');
                return;
            }

            try {
                document.getElementById('threatLoading').classList.remove('hidden');
                document.getElementById('threatResults').classList.add('hidden');

                const response = await fetch(`${API_BASE_URL}/api/threat/intel/${indicator}?type=${type}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                document.getElementById('threatLoading').classList.add('hidden');
                document.getElementById('threatResults').classList.remove('hidden');
                
                displayThreatResults(data);

            } catch (error) {
                console.error('Threat analysis error:', error);
                document.getElementById('threatLoading').classList.add('hidden');
                alert('Threat analysis failed: ' + error.message);
            }
        }

        function displayThreatResults(data) {
            const resultsDiv = document.getElementById('threatResults');
            
            if (!data.success) {
                resultsDiv.innerHTML = `<div class="text-red-400">Error: ${data.message}</div>`;
                return;
            }

            let html = `<div class="space-y-4">`;
            
            if (data.threatIntelligence.virustotal) {
                const vt = data.threatIntelligence.virustotal;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-shield-alt text-red-400"></i> ${vt.source}
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-400">Positives:</span> ${vt.positives}/${vt.total}</div>
                            <div><span class="text-gray-400">Scan Date:</span> ${vt.scanDate || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            if (data.threatIntelligence.abuseipdb) {
                const abuse = data.threatIntelligence.abuseipdb;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-exclamation-triangle text-orange-400"></i> ${abuse.source}
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-400">Abuse Score:</span> ${abuse.abuseConfidencePercentage}%</div>
                            <div><span class="text-gray-400">Reports:</span> ${abuse.totalReports}</div>
                            <div><span class="text-gray-400">Usage Type:</span> ${abuse.usageType || 'N/A'}</div>
                            <div><span class="text-gray-400">ISP:</span> ${abuse.isp || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            if (data.threatIntelligence.shodan) {
                const shodan = data.threatIntelligence.shodan;
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-search text-blue-400"></i> ${shodan.source}
                        </h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-gray-400">Country:</span> ${shodan.country || 'N/A'}</div>
                            <div><span class="text-gray-400">City:</span> ${shodan.city || 'N/A'}</div>
                            <div><span class="text-gray-400">Organization:</span> ${shodan.organization || 'N/A'}</div>
                            <div><span class="text-gray-400">OS:</span> ${shodan.operatingSystem || 'N/A'}</div>
                            <div><span class="text-gray-400">Ports:</span> ${shodan.ports?.join(', ') || 'N/A'}</div>
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
            resultsDiv.innerHTML = html;
        }

        async function bulkAnalyze() {
            const indicators = document.getElementById('bulkInput').value.trim().split('\n').filter(i => i.trim());
            if (indicators.length === 0) {
                alert('Please enter at least one indicator');
                return;
            }

            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please log in to use API intelligence features');
                return;
            }

            try {
                document.getElementById('bulkLoading').classList.remove('hidden');
                document.getElementById('bulkResults').classList.add('hidden');

                const response = await fetch(`${API_BASE_URL}/api/analyze/bulk`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ indicators })
                });

                const data = await response.json();
                
                document.getElementById('bulkLoading').classList.add('hidden');
                document.getElementById('bulkResults').classList.remove('hidden');
                
                displayBulkResults(data);

            } catch (error) {
                console.error('Bulk analysis error:', error);
                document.getElementById('bulkLoading').classList.add('hidden');
                alert('Bulk analysis failed: ' + error.message);
            }
        }

        function displayBulkResults(data) {
            const resultsDiv = document.getElementById('bulkResults');
            
            if (!data.success) {
                resultsDiv.innerHTML = `<div class="text-red-400">Error: ${data.message}</div>`;
                return;
            }

            let html = `<div class="space-y-4">`;
            
            data.analysis.forEach(analysis => {
                html += `
                    <div class="result-card">
                        <h4 class="font-semibold text-white mb-2">
                            <i class="fas fa-search text-yellow-400"></i> ${analysis.indicator}
                        </h4>
                        <div class="text-sm text-gray-300">
                            ${analysis.geolocation ? '<div class="text-green-400">✓ Geolocation data available</div>' : ''}
                            ${analysis.threatIntelligence ? '<div class="text-red-400">✓ Threat intelligence available</div>' : ''}
                            ${analysis.validation ? '<div class="text-blue-400">✓ Validation data available</div>' : ''}
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>

