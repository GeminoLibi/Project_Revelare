<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription Management - Project Revelare</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3891410174900441"
         crossorigin="anonymous"></script>
    <!-- Smart navigation will be loaded dynamically -->
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0F172A;
            color: #F8FAFC;
        }
        h1, h2, h3, h4 {
            font-family: 'Orbitron', sans-serif;
        }
        .card {
            background-color: #1E293B;
            border-top: 4px solid #3B82F6;
        }
        .pricing-card {
            background-color: #1E293B;
            border: 2px solid #374151;
            transition: all 0.3s ease;
            position: relative;
        }
        .pricing-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.3);
        }
        .pricing-card.featured {
            border-color: #3B82F6;
            transform: scale(1.05);
        }
        .pricing-card.featured:hover {
            transform: scale(1.05) translateY(-4px);
        }
        .feature-badge {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .loading-spinner {
            border: 3px solid #374151;
            border-top: 3px solid #3B82F6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- Navigation Container -->
    <div id="navigation-container"></div>

    <main class="pt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Header -->
            <div class="mb-8 text-center">
                <h1 class="text-4xl font-bold text-white mb-2">Subscription Management</h1>
                <p class="text-gray-400">Choose the plan that fits your investigation needs</p>
            </div>

            <!-- Current Subscription Status -->
            <div id="subscriptionStatus" class="card p-6 rounded-lg mb-8">
                <h2 class="text-xl font-semibold text-white mb-4">
                    <i class="fas fa-user-circle text-blue-500"></i> Current Subscription
                </h2>
                <div id="statusContent">
                    <div class="text-center py-4">
                        <div class="loading-spinner mx-auto mb-2"></div>
                        <p class="text-gray-400">Loading subscription status...</p>
                    </div>
                </div>
            </div>

            <!-- Pricing Plans -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-8">
                <!-- Hobbyist Plan -->
                <div class="pricing-card p-6 rounded-lg">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-white mb-2">Hobbyist</h3>
                        <div class="text-4xl font-bold text-gray-300 mb-2">Free</div>
                        <p class="text-gray-400">Perfect for personal projects</p>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Up to 3 cases
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Basic indicator extraction
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Community forum access
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Gumshoe games
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Basic string search
                        </li>
                    </ul>
                    <button class="w-full btn btn-outline" disabled>
                        <i class="fas fa-check"></i> Current Plan
                    </button>
                </div>

                <!-- Professional Plan -->
                <div class="pricing-card featured p-6 rounded-lg">
                    <div class="feature-badge">Most Popular</div>
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-white mb-2">Professional</h3>
                        <div class="text-4xl font-bold text-blue-400 mb-2">$29<span class="text-lg text-gray-400">/month</span></div>
                        <p class="text-gray-400">For serious investigators</p>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Unlimited cases
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Advanced indicator extraction
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Link analysis & visualization
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Fractal encryption
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Advanced string search & regex
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            <span class="font-semibold text-yellow-400">Log Analysis (Panomreles)</span>
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            <span class="font-semibold text-purple-400">Enhanced Fractal Encryption</span>
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Priority support
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Shared investigation spaces
                        </li>
                    </ul>
                    <button id="upgradeToProfessional" class="w-full btn btn-primary">
                        <i class="fas fa-arrow-up"></i> Upgrade to Professional
                    </button>
                </div>

                <!-- Enterprise Plan -->
                <div class="pricing-card p-6 rounded-lg">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-white mb-2">Enterprise</h3>
                        <div class="text-4xl font-bold text-gray-300 mb-2">$99<span class="text-lg text-gray-400">/month</span></div>
                        <p class="text-gray-400">For organizations</p>
                    </div>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Everything in Professional
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            <span class="font-semibold text-purple-400">Application Automation (UAAL)</span>
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            <span class="font-semibold text-blue-400">Install-it-All Integration</span>
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Custom integrations
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Dedicated support
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            On-premise deployment
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Custom reporting
                        </li>
                        <li class="flex items-center text-gray-300">
                            <i class="fas fa-check text-green-500 mr-3"></i>
                            Team management
                        </li>
                    </ul>
                    <button id="upgradeToEnterprise" class="w-full btn btn-outline">
                        <i class="fas fa-arrow-up"></i> Upgrade to Enterprise
                    </button>
                </div>
            </div>

            <!-- Features Comparison -->
            <div class="card p-6 rounded-lg">
                <h2 class="text-xl font-semibold text-white mb-6">
                    <i class="fas fa-table text-blue-500"></i> Feature Comparison
                </h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="text-left py-3 px-4 font-semibold text-gray-300">Feature</th>
                                <th class="text-center py-3 px-4 font-semibold text-gray-300">Hobbyist</th>
                                <th class="text-center py-3 px-4 font-semibold text-blue-400">Professional</th>
                                <th class="text-center py-3 px-4 font-semibold text-gray-300">Enterprise</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-300">
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">Cases</td>
                                <td class="text-center py-3 px-4">3</td>
                                <td class="text-center py-3 px-4">Unlimited</td>
                                <td class="text-center py-3 px-4">Unlimited</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">File Processing</td>
                                <td class="text-center py-3 px-4">Basic</td>
                                <td class="text-center py-3 px-4">Advanced</td>
                                <td class="text-center py-3 px-4">Advanced</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">String Search</td>
                                <td class="text-center py-3 px-4">Basic</td>
                                <td class="text-center py-3 px-4">Regex Support</td>
                                <td class="text-center py-3 px-4">Regex Support</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">Link Analysis</td>
                                <td class="text-center py-3 px-4">-</td>
                                <td class="text-center py-3 px-4">✓</td>
                                <td class="text-center py-3 px-4">✓</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">Fractal Encryption</td>
                                <td class="text-center py-3 px-4">Basic</td>
                                <td class="text-center py-3 px-4">Enhanced Multi-Layer</td>
                                <td class="text-center py-3 px-4">Enhanced Multi-Layer</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">Log Analysis</td>
                                <td class="text-center py-3 px-4">-</td>
                                <td class="text-center py-3 px-4">✓ Panomreles</td>
                                <td class="text-center py-3 px-4">✓ Panomreles</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">Application Automation</td>
                                <td class="text-center py-3 px-4">-</td>
                                <td class="text-center py-3 px-4">-</td>
                                <td class="text-center py-3 px-4">✓ UAAL</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">System Integration</td>
                                <td class="text-center py-3 px-4">-</td>
                                <td class="text-center py-3 px-4">-</td>
                                <td class="text-center py-3 px-4">✓ Install-it-All</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">Shared Spaces</td>
                                <td class="text-center py-3 px-4">-</td>
                                <td class="text-center py-3 px-4">✓</td>
                                <td class="text-center py-3 px-4">✓</td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-3 px-4">Support</td>
                                <td class="text-center py-3 px-4">Community</td>
                                <td class="text-center py-3 px-4">Priority</td>
                                <td class="text-center py-3 px-4">Dedicated</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        // API Configuration
        const SUBSCRIPTION_API_BASE_URL = 'https://project-revelare-backend.liberatorgeminorum.workers.dev';
        
        // Initialize Stripe
        const stripe = Stripe('pk_live_51SHS03LG1p449dDevSE5NKfQ4qwp4WR9r9kspuJLl192KIxLexHkSsBvLly76OQB5hVWMlXIUvhQv66VnHc7PesD00PyMjG24u');
        
        // Stripe Price IDs - Replace with your actual Stripe Price IDs
        const STRIPE_PRICE_IDS = {
            professional: 'price_1SHVVWLG1p449dDeglzweIUN', // Professional Tier Price ID
            enterprise: 'price_1SHVW7LG1p449dDexYRjhhDb'    // Enterprise Tier Price ID
        };

        // Load subscription status and setup event listeners
        document.addEventListener('DOMContentLoaded', async function() {
            // Load subscription status
            setTimeout(loadSubscriptionStatus, 1000);
            
            // Setup event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('upgradeToProfessional').addEventListener('click', () => upgradeToTier('professional'));
            document.getElementById('upgradeToEnterprise').addEventListener('click', () => upgradeToTier('enterprise'));
        }

        async function loadSubscriptionStatus() {
            try {
                const authToken = localStorage.getItem('authToken');
                if (!authToken) {
                    window.location.href = '/login';
                    return;
                }

                const response = await fetch(`${SUBSCRIPTION_API_BASE_URL}/api/payments/subscription-status`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displaySubscriptionStatus(data.subscription);
                } else {
                    throw new Error('Failed to load subscription status');
                }
            } catch (error) {
                console.error('Error loading subscription status:', error);
                document.getElementById('statusContent').innerHTML = `
                    <div class="text-center text-red-400 py-4">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Failed to load subscription status</p>
                    </div>
                `;
            }
        }

        function displaySubscriptionStatus(subscription) {
            const statusContent = document.getElementById('statusContent');
            
            const statusColor = subscription.isActive ? 'text-green-400' : 'text-yellow-400';
            const statusIcon = subscription.isActive ? 'fa-check-circle' : 'fa-clock';
            const tierColor = subscription.tier === 'professional' ? 'text-blue-400' : 'text-gray-400';
            
            statusContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center p-4 bg-gray-800 rounded-lg">
                        <div class="text-2xl font-bold ${tierColor}">${subscription.tier.charAt(0).toUpperCase() + subscription.tier.slice(1)}</div>
                        <div class="text-sm text-gray-400">Current Plan</div>
                    </div>
                    <div class="text-center p-4 bg-gray-800 rounded-lg">
                        <div class="text-2xl font-bold ${statusColor}">
                            <i class="fas ${statusIcon}"></i>
                        </div>
                        <div class="text-sm text-gray-400">Status</div>
                    </div>
                    <div class="text-center p-4 bg-gray-800 rounded-lg">
                        <div class="text-2xl font-bold text-gray-300">${new Date(subscription.createdAt).toLocaleDateString()}</div>
                        <div class="text-sm text-gray-400">Member Since</div>
                    </div>
                </div>
            `;

            // Update button states based on current subscription
            if (subscription.tier === 'professional') {
                document.getElementById('upgradeToProfessional').innerHTML = '<i class="fas fa-check"></i> Current Plan';
                document.getElementById('upgradeToProfessional').disabled = true;
                document.getElementById('upgradeToProfessional').classList.remove('btn-primary');
                document.getElementById('upgradeToProfessional').classList.add('btn-outline');
            }
        }

        async function upgradeToTier(tier) {
            try {
                const authToken = localStorage.getItem('authToken');
                if (!authToken) {
                    window.location.href = '/login';
                    return;
                }

                const priceId = STRIPE_PRICE_IDS[tier];
                if (!priceId) {
                    alert('Price ID not configured for this tier');
                    return;
                }
                
                const response = await fetch(`${SUBSCRIPTION_API_BASE_URL}/api/payments/create-checkout-session`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        priceId: priceId,
                        tier: tier,
                        successUrl: `${SUBSCRIPTION_API_BASE_URL}/subscription-success.html`,
                        cancelUrl: `${SUBSCRIPTION_API_BASE_URL}/subscription`
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    window.location.href = data.url;
                } else {
                    throw new Error('Failed to create checkout session');
                }
            } catch (error) {
                console.error('Upgrade error:', error);
                alert('Failed to start upgrade process. Please try again.');
            }
        }
    </script>
</body>
</html>

