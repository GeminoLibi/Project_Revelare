<!-- Universal Navigation Container -->
<div id="navigation-container"></div>

<!-- Smart Navigation Loader -->
<script>
// Smart Navigation Loader - Loads navigation based on user's highest tier
// Define API_BASE_URL if not already defined
if (typeof API_BASE_URL === 'undefined') {
    const API_BASE_URL = 'https://project-revelare-backend.liberatorgeminorum.workers.dev';
}

async function loadSmartNavigation() {
    try {
        // Try to get user info - cookies will be sent automatically
        const response = await fetch(`${API_BASE_URL}/api/me`, {
            credentials: 'include' // This ensures cookies are sent
        });

        if (!response.ok) {
            // Not authenticated - load public navigation
            await loadNavigationComponent('/components/navigation-public.html');
            return;
        }

        const userData = await response.json();
        
        // Determine navigation based on user's highest tier
        if (userData.isAdmin) {
            await loadNavigationComponent('/components/navigation-admin.html');
        } else if (userData.accessTier === 'enterprise') {
            await loadNavigationComponent('/components/navigation-enterprise.html');
        } else if (userData.accessTier === 'professional') {
            await loadNavigationComponent('/components/navigation-professional.html');
        } else {
            // Hobbyist or any other authenticated user
            await loadNavigationComponent('/components/navigation-hobbyist.html');
        }
        
    } catch (error) {
        console.error('Failed to load user data:', error);
        // Fallback to public navigation
        await loadNavigationComponent('/components/navigation-public.html');
    }
}

async function loadNavigationComponent(path) {
    try {
        const response = await fetch(path);
        if (!response.ok) {
            throw new Error(`Failed to fetch ${path}: ${response.status}`);
        }
        const html = await response.text();
        const container = document.getElementById('navigation-container');
        if (container) {
            container.innerHTML = html;
            
            // Extract and execute any script tags from the loaded HTML
            const scripts = container.querySelectorAll('script');
            scripts.forEach(script => {
                const newScript = document.createElement('script');
                if (script.src) {
                    newScript.src = script.src;
                } else {
                    newScript.textContent = script.textContent;
                }
                document.head.appendChild(newScript);
            });
        }
    } catch (error) {
        console.error('Failed to load navigation component:', error);
        // Ultimate fallback - create a basic navigation
        const container = document.getElementById('navigation-container');
        if (container) {
            container.innerHTML = `
                <header class="bg-gray-900 border-b border-gray-700 fixed top-0 left-0 right-0 z-50">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex items-center justify-between h-16">
                            <a href="/index.html" class="text-xl font-bold text-white flex items-center gap-2">
                                <i class="fas fa-search"></i> Project Revelare
                            </a>
                            <div class="flex items-center gap-4">
                                <a href="/login.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Login</a>
                                <a href="/register.html" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-medium">Register</a>
                            </div>
                        </div>
                    </div>
                </header>
                <div class="pt-20"></div>
            `;
        }
    }
}

// Initialize smart navigation when DOM loads
document.addEventListener('DOMContentLoaded', loadSmartNavigation);
</script>

